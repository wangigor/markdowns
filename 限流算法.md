#  限流算法

## 固定窗口

> 比较简单。
>
> 设置一个线程安全的自增计数器，周期性清零。
>
> 直接上代码。

```java
//因为我测试类比较简单，日志用的slf4j-simple
//所以要增加几个jvm启动参数设置日志格式
//-Dorg.slf4j.simpleLogger.showDateTime=true 显示日期
//-Dorg.slf4j.simpleLogger.showThreadName=false 不显示线程名称
//-Dorg.slf4j.simpleLogger.showLogName=false 不显示类名
//-Dorg.slf4j.simpleLogger.dateTimeFormat="yyyy-MM-dd HH:mm:ss:SSS" 日期格式
@Slf4j
public class CounterLimiter {
    private Unsafe unsafe;
    private final int limit;
    private long countOffset;
    private int count;

    @SneakyThrows
    public CounterLimiter(int limit, long period) {
        this.limit = limit;
        Field theUnsafe = Unsafe.class.getDeclaredField("theUnsafe");
        theUnsafe.setAccessible(true);
        unsafe = (Unsafe) theUnsafe.get(null);
        this.countOffset = unsafe.objectFieldOffset(CounterLimiter.class.getDeclaredField("count"));
        Timer timer = new Timer("CounterLimiter");
        timer.schedule(new TimerTask() {
            @Override
            public void run() {
                count = 0;
            }
        }, 0L, period);
    }

    /**
     * 能否执行
     */
    public boolean access() {
        int current;
        //自旋锁
        while (!unsafe.compareAndSwapInt(this, countOffset, count, current = count + 1)) ;
        return current <= limit;
    }

    public static void main(String[] args) throws InterruptedException {

        CounterLimiter counterLimiter = new CounterLimiter(20, 1000L);

        //第一批50个同步执行
        IntStream.range(0, 50).parallel().forEach(i -> log.info("第一批：" + i + "-" + (counterLimiter.access() ? "放行" : "拦截")));

        TimeUnit.MILLISECONDS.sleep(1000);

        //第二批50个同步执行
        IntStream.range(0, 50).parallel().forEach(i -> log.info("第二批：" + i + "-" + (counterLimiter.access() ? "放行" : "拦截")));
        new CountDownLatch(1).await();
    }
}
```

结果是

```log
2021-07-08 15:30:47:214 INFO 第一批：28-放行
2021-07-08 15:30:47:214 INFO 第一批：32-放行
2021-07-08 15:30:47:214 INFO 第一批：35-放行
2021-07-08 15:30:47:214 INFO 第一批：22-放行
2021-07-08 15:30:47:214 INFO 第一批：48-放行
2021-07-08 15:30:47:214 INFO 第一批：44-放行
2021-07-08 15:30:47:216 INFO 第一批：36-放行
2021-07-08 15:30:47:214 INFO 第一批：34-放行
2021-07-08 15:30:47:216 INFO 第一批：27-放行
2021-07-08 15:30:47:216 INFO 第一批：19-拦截
2021-07-08 15:30:47:214 INFO 第一批：15-放行
2021-07-08 15:30:47:216 INFO 第一批：45-拦截
2021-07-08 15:30:47:214 INFO 第一批：25-放行
2021-07-08 15:30:47:214 INFO 第一批：26-放行
2021-07-08 15:30:47:214 INFO 第一批：43-放行
2021-07-08 15:30:47:216 INFO 第一批：20-拦截
2021-07-08 15:30:47:214 INFO 第一批：30-放行
2021-07-08 15:30:47:214 INFO 第一批：40-放行
2021-07-08 15:30:47:214 INFO 第一批：3-放行
2021-07-08 15:30:47:216 INFO 第一批：29-拦截
2021-07-08 15:30:47:216 INFO 第一批：37-拦截
2021-07-08 15:30:47:216 INFO 第一批：42-拦截
2021-07-08 15:30:47:216 INFO 第一批：16-拦截
2021-07-08 15:30:47:216 INFO 第一批：24-拦截
2021-07-08 15:30:47:216 INFO 第一批：18-拦截
2021-07-08 15:30:47:216 INFO 第一批：17-拦截
2021-07-08 15:30:47:216 INFO 第一批：21-放行
2021-07-08 15:30:47:216 INFO 第一批：49-拦截
2021-07-08 15:30:47:216 INFO 第一批：33-放行
2021-07-08 15:30:47:214 INFO 第一批：7-放行
2021-07-08 15:30:47:214 INFO 第一批：38-放行
2021-07-08 15:30:47:217 INFO 第一批：0-拦截
2021-07-08 15:30:47:217 INFO 第一批：8-拦截
2021-07-08 15:30:47:217 INFO 第一批：23-拦截
2021-07-08 15:30:47:217 INFO 第一批：31-拦截
2021-07-08 15:30:47:217 INFO 第一批：41-拦截
2021-07-08 15:30:47:217 INFO 第一批：1-拦截
2021-07-08 15:30:47:217 INFO 第一批：2-拦截
2021-07-08 15:30:47:217 INFO 第一批：12-拦截
2021-07-08 15:30:47:217 INFO 第一批：14-拦截
2021-07-08 15:30:47:217 INFO 第一批：46-拦截
2021-07-08 15:30:47:216 INFO 第一批：39-拦截
2021-07-08 15:30:47:216 INFO 第一批：13-拦截
2021-07-08 15:30:47:217 INFO 第一批：10-拦截
2021-07-08 15:30:47:217 INFO 第一批：6-拦截
2021-07-08 15:30:47:217 INFO 第一批：9-拦截
2021-07-08 15:30:47:217 INFO 第一批：11-拦截
2021-07-08 15:30:47:217 INFO 第一批：5-拦截
2021-07-08 15:30:47:217 INFO 第一批：4-拦截
2021-07-08 15:30:47:217 INFO 第一批：47-拦截
2021-07-08 15:30:48:220 INFO 第二批：32-放行
2021-07-08 15:30:48:220 INFO 第二批：7-放行
2021-07-08 15:30:48:220 INFO 第二批：44-放行
2021-07-08 15:30:48:220 INFO 第二批：8-放行
2021-07-08 15:30:48:220 INFO 第二批：45-放行
2021-07-08 15:30:48:220 INFO 第二批：22-放行
2021-07-08 15:30:48:220 INFO 第二批：6-放行
2021-07-08 15:30:48:220 INFO 第二批：47-放行
2021-07-08 15:30:48:220 INFO 第二批：25-放行
2021-07-08 15:30:48:221 INFO 第二批：10-拦截
2021-07-08 15:30:48:220 INFO 第二批：13-放行
2021-07-08 15:30:48:220 INFO 第二批：26-放行
2021-07-08 15:30:48:220 INFO 第二批：40-放行
2021-07-08 15:30:48:220 INFO 第二批：43-放行
2021-07-08 15:30:48:220 INFO 第二批：30-拦截
2021-07-08 15:30:48:220 INFO 第二批：3-放行
2021-07-08 15:30:48:222 INFO 第二批：17-拦截
2021-07-08 15:30:48:221 INFO 第二批：14-拦截
2021-07-08 15:30:48:222 INFO 第二批：16-拦截
2021-07-08 15:30:48:222 INFO 第二批：5-拦截
2021-07-08 15:30:48:222 INFO 第二批：24-拦截
2021-07-08 15:30:48:221 INFO 第二批：11-拦截
2021-07-08 15:30:48:220 INFO 第二批：15-放行
2021-07-08 15:30:48:222 INFO 第二批：9-拦截
2021-07-08 15:30:48:220 INFO 第二批：48-放行
2021-07-08 15:30:48:221 INFO 第二批：46-拦截
2021-07-08 15:30:48:222 INFO 第二批：49-拦截
2021-07-08 15:30:48:222 INFO 第二批：1-拦截
2021-07-08 15:30:48:222 INFO 第二批：34-拦截
2021-07-08 15:30:48:222 INFO 第二批：23-拦截
2021-07-08 15:30:48:222 INFO 第二批：29-拦截
2021-07-08 15:30:48:223 INFO 第二批：20-拦截
2021-07-08 15:30:48:222 INFO 第二批：12-拦截
2021-07-08 15:30:48:223 INFO 第二批：36-拦截
2021-07-08 15:30:48:220 INFO 第二批：35-放行
2021-07-08 15:30:48:220 INFO 第二批：21-拦截
2021-07-08 15:30:48:221 INFO 第二批：19-拦截
2021-07-08 15:30:48:221 INFO 第二批：27-拦截
2021-07-08 15:30:48:221 INFO 第二批：42-拦截
2021-07-08 15:30:48:220 INFO 第二批：33-放行
2021-07-08 15:30:48:220 INFO 第二批：28-放行
2021-07-08 15:30:48:220 INFO 第二批：31-放行
2021-07-08 15:30:48:223 INFO 第二批：39-拦截
2021-07-08 15:30:48:223 INFO 第二批：41-拦截
2021-07-08 15:30:48:223 INFO 第二批：37-拦截
2021-07-08 15:30:48:223 INFO 第二批：38-拦截
2021-07-08 15:30:48:223 INFO 第二批：2-拦截
2021-07-08 15:30:48:223 INFO 第二批：0-拦截
2021-07-08 15:30:48:223 INFO 第二批：18-拦截
2021-07-08 15:30:48:222 INFO 第二批：4-拦截
```

刚好就是第一批放行20个，第二批放行20个。奇怪不奇怪？嗯？

> <img src="https://gitee.com/wangigor/typora-images/raw/master/image-20210713155702932.png" alt="image-20210713155702932" style="zoom:50%;" />
>
> 上面的数据经过削峰，整流成了大概这个样子。
>
> 但是会有「**突刺流量**问题，也就是临界突发流量问题」，看下图。
>
> <img src="https://gitee.com/wangigor/typora-images/raw/master/image-20210713155941374.png" alt="image-20210713155941374" style="zoom:50%;" />
>
> 在第1秒的最后和第2秒的开始，两个流量叠加。导致系统承受的负载翻倍。
>
> 所以优化出了滑动窗口算法。

## 滑动窗口

> 滑动窗口就是让窗口动起来。<img src="https://gitee.com/wangigor/typora-images/raw/master/image-20210714095855745.png" alt="image-20210714095855745" style="zoom:50%;" />
>
> 从**任意时刻**向后或向前的1s内，都不能超过流量限制。

为了要达到这样的效果呢，需要**保存每一次通过的时间**，从小到大排列。当有新请求进来时，如果已保存的数量没到限制，就继续追加；如果已经达到限制，尝试删除最小的一个再插入。当然要满足的前提是「**最小的一个跟当前请求的时间间隔要超过周期**」。

可以使用链表，也可以使用数组。

下面是我使用循环数组的循环填充实现。

```java
@Slf4j
public class TimeSlidingWindowLimiter {

    //限流周期
    private final long period;
    //限流周期单位
    private final TimeUnit timeUnit;
    //限制数量
    private final int limit;
    //计算得到的时间间隔步长
    private final long timeStep;

    //循环数组
    private final long[] nanoCycle;

    //指针位置
    private AtomicInteger index;

    @SneakyThrows
    public TimeSlidingWindowLimiter(int limit, long period, TimeUnit timeUnit) {
        this.limit = limit;
        this.period = period;
        this.timeUnit = timeUnit;
        this.nanoCycle = new long[limit];
        this.index = new AtomicInteger(0);
        this.timeStep = timeUnit.toNanos(this.period);
    }

    public boolean access() {
        long now = System.nanoTime();
        long stepBefore = now - timeStep;
        int i;
        //后续所有比他小的都可以试试
        while (stepBefore >= nanoCycle[i = index.get()]) {
            //抢到才算，被其他线程抢到就要继续循环
            if (index.compareAndSet(i, (i + 1) % limit)) {
                nanoCycle[i] = now;
                return true;
            }
        }
        
        return false;
    }


    public static void main(String[] args) throws InterruptedException {
        TimeSlidingWindowLimiter windowLimiter = new TimeSlidingWindowLimiter(20, 1, TimeUnit.SECONDS);
        IntStream.range(0, 1000).parallel().forEach(i -> {
            try {
                TimeUnit.MILLISECONDS.sleep(100);
            } catch (InterruptedException e) {
                e.printStackTrace();
            }
            if (windowLimiter.access()) {
                log.info(i + "放行");
            } else {
                log.debug(i + "拦截");
            }
        });

        new CountDownLatch(1).await();
    }
}
```

运行结果

***

<font color=green>2021-07-14 09:25:48:096 INFO 156放行</font>
<font color=green>2021-07-14 09:25:48:095 INFO 327放行</font>
<font color=green>2021-07-14 09:25:48:096 INFO 718放行</font>
<font color=green>2021-07-14 09:25:48:095 INFO 656放行</font>
<font color=green>2021-07-14 09:25:48:096 INFO 531放行</font>
<font color=green>2021-07-14 09:25:48:095 INFO 577放行</font>
<font color=green>2021-07-14 09:25:48:097 INFO 515放行</font>
<font color=green>2021-07-14 09:25:48:096 INFO 827放行</font>
<font color=green>2021-07-14 09:25:48:095 INFO 702放行</font>
<font color=green>2021-07-14 09:25:48:095 INFO 921放行</font>
<font color=green>2021-07-14 09:25:48:095 INFO 890放行</font>
<font color=green>2021-07-14 09:25:48:095 INFO 609放行</font>
<font color=green>2021-07-14 09:25:48:096 INFO 452放行</font>
<font color=green>2021-07-14 09:25:48:096 INFO 906放行</font>
<font color=green>2021-07-14 09:25:48:095 INFO 968放行</font>
<font color=green>2021-07-14 09:25:48:095 INFO 781放行</font>
<font color=green>2021-07-14 09:25:48:202 INFO 328放行</font>
2021-07-14 09:25:48:202 DEBUG 516拦截
2021-07-14 09:25:48:202 DEBUG 532拦截
2021-07-14 09:25:48:203 DEBUG 922拦截
<font color=green>2021-07-14 09:25:48:202 INFO 828放行</font>
<font color=green>2021-07-14 09:25:48:202 INFO 703放行</font>
<font color=green>2021-07-14 09:25:48:202 INFO 657放行</font>
2021-07-14 09:25:48:203 DEBUG 610拦截
2021-07-14 09:25:48:203 DEBUG 157拦截
2021-07-14 09:25:48:203 DEBUG 782拦截
2021-07-14 09:25:48:203 DEBUG 453拦截
2021-07-14 09:25:48:203 DEBUG 969拦截
2021-07-14 09:25:48:203 DEBUG 578拦截
2021-07-14 09:25:48:203 DEBUG 907拦截
2021-07-14 09:25:48:203 DEBUG 719拦截
2021-07-14 09:25:48:203 DEBUG 891拦截
2021-07-14 09:25:48:304 DEBUG 329拦截
2021-07-14 09:25:48:304 DEBUG 611拦截
2021-07-14 09:25:48:304 DEBUG 658拦截
2021-07-14 09:25:48:304 DEBUG 704拦截
2021-07-14 09:25:48:304 DEBUG 517拦截
2021-07-14 09:25:48:304 DEBUG 829拦截
2021-07-14 09:25:48:304 DEBUG 158拦截
2021-07-14 09:25:48:304 DEBUG 923拦截
2021-07-14 09:25:48:304 DEBUG 533拦截
2021-07-14 09:25:48:307 DEBUG 783拦截
2021-07-14 09:25:48:307 DEBUG 892拦截
2021-07-14 09:25:48:307 DEBUG 970拦截
2021-07-14 09:25:48:307 DEBUG 908拦截
2021-07-14 09:25:48:307 DEBUG 454拦截
2021-07-14 09:25:48:307 DEBUG 579拦截
2021-07-14 09:25:48:307 DEBUG 720拦截
2021-07-14 09:25:48:409 DEBUG 705拦截
2021-07-14 09:25:48:409 DEBUG 534拦截
2021-07-14 09:25:48:409 DEBUG 518拦截
2021-07-14 09:25:48:409 DEBUG 830拦截
2021-07-14 09:25:48:409 DEBUG 924拦截
2021-07-14 09:25:48:409 DEBUG 612拦截
2021-07-14 09:25:48:409 DEBUG 159拦截
2021-07-14 09:25:48:409 DEBUG 659拦截
2021-07-14 09:25:48:409 DEBUG 330拦截
2021-07-14 09:25:48:410 DEBUG 893拦截
2021-07-14 09:25:48:410 DEBUG 721拦截
2021-07-14 09:25:48:410 DEBUG 909拦截
2021-07-14 09:25:48:410 DEBUG 580拦截
2021-07-14 09:25:48:410 DEBUG 455拦截
2021-07-14 09:25:48:410 DEBUG 971拦截
2021-07-14 09:25:48:410 DEBUG 784拦截
2021-07-14 09:25:48:513 DEBUG 519拦截
2021-07-14 09:25:48:513 DEBUG 831拦截
2021-07-14 09:25:48:513 DEBUG 160拦截
2021-07-14 09:25:48:513 DEBUG 925拦截
2021-07-14 09:25:48:513 DEBUG 613拦截
2021-07-14 09:25:48:513 DEBUG 535拦截
2021-07-14 09:25:48:513 DEBUG 706拦截
2021-07-14 09:25:48:514 DEBUG 581拦截
2021-07-14 09:25:48:514 DEBUG 894拦截
2021-07-14 09:25:48:514 DEBUG 785拦截
2021-07-14 09:25:48:514 DEBUG 456拦截
2021-07-14 09:25:48:514 DEBUG 972拦截
2021-07-14 09:25:48:514 DEBUG 722拦截
2021-07-14 09:25:48:514 DEBUG 910拦截
2021-07-14 09:25:48:514 DEBUG 331拦截
2021-07-14 09:25:48:514 DEBUG 660拦截
2021-07-14 09:25:48:615 DEBUG 614拦截
2021-07-14 09:25:48:615 DEBUG 926拦截
2021-07-14 09:25:48:615 DEBUG 973拦截
2021-07-14 09:25:48:615 DEBUG 723拦截
2021-07-14 09:25:48:615 DEBUG 911拦截
2021-07-14 09:25:48:615 DEBUG 786拦截
2021-07-14 09:25:48:615 DEBUG 895拦截
2021-07-14 09:25:48:615 DEBUG 457拦截
2021-07-14 09:25:48:615 DEBUG 161拦截
2021-07-14 09:25:48:615 DEBUG 582拦截
2021-07-14 09:25:48:615 DEBUG 536拦截
2021-07-14 09:25:48:615 DEBUG 832拦截
2021-07-14 09:25:48:615 DEBUG 520拦截
2021-07-14 09:25:48:615 DEBUG 707拦截
2021-07-14 09:25:48:620 DEBUG 332拦截
2021-07-14 09:25:48:620 DEBUG 661拦截
2021-07-14 09:25:48:720 DEBUG 615拦截
2021-07-14 09:25:48:720 DEBUG 833拦截
2021-07-14 09:25:48:720 DEBUG 708拦截
2021-07-14 09:25:48:720 DEBUG 583拦截
2021-07-14 09:25:48:720 DEBUG 537拦截
2021-07-14 09:25:48:720 DEBUG 521拦截
2021-07-14 09:25:48:720 DEBUG 162拦截
2021-07-14 09:25:48:720 DEBUG 458拦截
2021-07-14 09:25:48:720 DEBUG 787拦截
2021-07-14 09:25:48:720 DEBUG 896拦截
2021-07-14 09:25:48:720 DEBUG 912拦截
2021-07-14 09:25:48:720 DEBUG 724拦截
2021-07-14 09:25:48:720 DEBUG 974拦截
2021-07-14 09:25:48:720 DEBUG 927拦截
2021-07-14 09:25:48:723 DEBUG 333拦截
2021-07-14 09:25:48:723 DEBUG 662拦截
2021-07-14 09:25:48:820 DEBUG 834拦截
2021-07-14 09:25:48:820 DEBUG 913拦截
2021-07-14 09:25:48:820 DEBUG 897拦截
2021-07-14 09:25:48:820 DEBUG 788拦截
2021-07-14 09:25:48:820 DEBUG 975拦截
2021-07-14 09:25:48:820 DEBUG 584拦截
2021-07-14 09:25:48:820 DEBUG 616拦截
2021-07-14 09:25:48:820 DEBUG 538拦截
2021-07-14 09:25:48:820 DEBUG 709拦截
2021-07-14 09:25:48:820 DEBUG 163拦截
2021-07-14 09:25:48:820 DEBUG 522拦截
2021-07-14 09:25:48:820 DEBUG 459拦截
2021-07-14 09:25:48:820 DEBUG 928拦截
2021-07-14 09:25:48:820 DEBUG 725拦截
2021-07-14 09:25:48:823 DEBUG 334拦截
2021-07-14 09:25:48:823 DEBUG 663拦截
2021-07-14 09:25:48:923 DEBUG 585拦截
2021-07-14 09:25:48:923 DEBUG 460拦截
2021-07-14 09:25:48:923 DEBUG 617拦截
2021-07-14 09:25:48:923 DEBUG 523拦截
2021-07-14 09:25:48:923 DEBUG 976拦截
2021-07-14 09:25:48:923 DEBUG 726拦截
2021-07-14 09:25:48:923 DEBUG 539拦截
2021-07-14 09:25:48:923 DEBUG 914拦截
2021-07-14 09:25:48:923 DEBUG 929拦截
2021-07-14 09:25:48:923 DEBUG 164拦截
2021-07-14 09:25:48:923 DEBUG 898拦截
2021-07-14 09:25:48:923 DEBUG 789拦截
2021-07-14 09:25:48:923 DEBUG 710拦截
2021-07-14 09:25:48:923 DEBUG 835拦截
2021-07-14 09:25:48:927 DEBUG 335拦截
2021-07-14 09:25:48:927 DEBUG 664拦截
2021-07-14 09:25:49:026 DEBUG 727拦截
2021-07-14 09:25:49:026 DEBUG 540拦截
2021-07-14 09:25:49:026 DEBUG 790拦截
2021-07-14 09:25:49:026 DEBUG 836拦截
2021-07-14 09:25:49:026 DEBUG 899拦截
2021-07-14 09:25:49:026 DEBUG 461拦截
2021-07-14 09:25:49:026 DEBUG 711拦截
2021-07-14 09:25:49:026 DEBUG 977拦截
2021-07-14 09:25:49:026 DEBUG 586拦截
2021-07-14 09:25:49:026 DEBUG 165拦截
2021-07-14 09:25:49:026 DEBUG 915拦截
2021-07-14 09:25:49:026 DEBUG 618拦截
2021-07-14 09:25:49:026 DEBUG 930拦截
2021-07-14 09:25:49:026 DEBUG 524拦截
2021-07-14 09:25:49:032 DEBUG 665拦截
2021-07-14 09:25:49:032 DEBUG 336拦截
<font color=green>2021-07-14 09:25:49:129 INFO 541放行</font>
<font color=green>2021-07-14 09:25:49:129 INFO 587放行</font>
<font color=green>2021-07-14 09:25:49:129 INFO 728放行</font>
<font color=green>2021-07-14 09:25:49:129 INFO 978放行</font>
<font color=green>2021-07-14 09:25:49:129 INFO 166放行</font>
<font color=green>2021-07-14 09:25:49:129 INFO 462放行</font>
<font color=green>2021-07-14 09:25:49:129 INFO 619放行</font>
<font color=green>2021-07-14 09:25:49:129 INFO 791放行</font>
<font color=green>2021-07-14 09:25:49:129 INFO 916放行</font>
<font color=green>2021-07-14 09:25:49:129 INFO 931放行</font>
<font color=green>2021-07-14 09:25:49:129 INFO 712放行</font>
<font color=green>2021-07-14 09:25:49:129 INFO 525放行</font>
<font color=green>2021-07-14 09:25:49:129 INFO 837放行</font>
<font color=green>2021-07-14 09:25:49:129 INFO 900放行</font>
<font color=green>2021-07-14 09:25:49:136 INFO 666放行</font>
<font color=green>2021-07-14 09:25:49:136 INFO 337放行</font>
<font color=green>2021-07-14 09:25:49:232 INFO 729放行</font>
2021-07-14 09:25:49:232 DEBUG 713拦截
2021-07-14 09:25:49:232 DEBUG 932拦截
2021-07-14 09:25:49:232 DEBUG 526拦截
2021-07-14 09:25:49:232 DEBUG 838拦截
2021-07-14 09:25:49:232 DEBUG 901拦截
<font color=green>2021-07-14 09:25:49:232 INFO 979放行</font>
2021-07-14 09:25:49:232 DEBUG 620拦截
<font color=green>2021-07-14 09:25:49:232 INFO 588放行</font>
2021-07-14 09:25:49:232 DEBUG 463拦截
<font color=green>2021-07-14 09:25:49:232 INFO 542放行</font>
2021-07-14 09:25:49:232 DEBUG 167拦截
2021-07-14 09:25:49:234 DEBUG 792拦截
2021-07-14 09:25:49:234 DEBUG 917拦截
2021-07-14 09:25:49:241 DEBUG 667拦截
2021-07-14 09:25:49:241 DEBUG 338拦截
2021-07-14 09:25:49:336 DEBUG 527拦截
2021-07-14 09:25:49:336 DEBUG 933拦截
2021-07-14 09:25:49:336 DEBUG 714拦截
2021-07-14 09:25:49:336 DEBUG 730拦截
2021-07-14 09:25:49:336 DEBUG 839拦截
2021-07-14 09:25:49:336 DEBUG 902拦截
2021-07-14 09:25:49:336 DEBUG 980拦截
2021-07-14 09:25:49:338 DEBUG 589拦截
2021-07-14 09:25:49:338 DEBUG 543拦截
2021-07-14 09:25:49:338 DEBUG 621拦截
2021-07-14 09:25:49:338 DEBUG 464拦截
2021-07-14 09:25:49:338 DEBUG 793拦截
2021-07-14 09:25:49:338 DEBUG 918拦截
2021-07-14 09:25:49:338 DEBUG 168拦截
2021-07-14 09:25:49:343 DEBUG 668拦截
2021-07-14 09:25:49:343 DEBUG 339拦截
2021-07-14 09:25:49:437 DEBUG 731拦截
2021-07-14 09:25:49:437 DEBUG 528拦截
2021-07-14 09:25:49:437 DEBUG 981拦截
2021-07-14 09:25:49:437 DEBUG 903拦截
2021-07-14 09:25:49:437 DEBUG 715拦截
2021-07-14 09:25:49:437 DEBUG 934拦截
2021-07-14 09:25:49:437 DEBUG 840拦截
2021-07-14 09:25:49:438 DEBUG 590拦截
2021-07-14 09:25:49:438 DEBUG 169拦截
2021-07-14 09:25:49:438 DEBUG 919拦截
2021-07-14 09:25:49:438 DEBUG 465拦截
2021-07-14 09:25:49:438 DEBUG 794拦截
2021-07-14 09:25:49:438 DEBUG 622拦截
2021-07-14 09:25:49:438 DEBUG 544拦截
2021-07-14 09:25:49:444 DEBUG 340拦截
2021-07-14 09:25:49:444 DEBUG 669拦截
2021-07-14 09:25:49:538 DEBUG 529拦截
2021-07-14 09:25:49:538 DEBUG 732拦截
2021-07-14 09:25:49:538 DEBUG 935拦截
2021-07-14 09:25:49:538 DEBUG 841拦截
2021-07-14 09:25:49:539 DEBUG 591拦截
2021-07-14 09:25:49:538 DEBUG 716拦截
2021-07-14 09:25:49:538 DEBUG 904拦截
2021-07-14 09:25:49:538 DEBUG 982拦截
2021-07-14 09:25:49:539 DEBUG 920拦截
2021-07-14 09:25:49:539 DEBUG 170拦截
2021-07-14 09:25:49:539 DEBUG 466拦截
2021-07-14 09:25:49:539 DEBUG 795拦截
2021-07-14 09:25:49:539 DEBUG 545拦截
2021-07-14 09:25:49:539 DEBUG 623拦截
2021-07-14 09:25:49:549 DEBUG 341拦截
2021-07-14 09:25:49:549 DEBUG 670拦截
2021-07-14 09:25:49:641 DEBUG 733拦截
2021-07-14 09:25:49:641 DEBUG 842拦截
2021-07-14 09:25:49:641 DEBUG 592拦截
2021-07-14 09:25:49:641 DEBUG 530拦截
2021-07-14 09:25:49:641 DEBUG 905拦截
2021-07-14 09:25:49:641 DEBUG 983拦截
2021-07-14 09:25:49:641 DEBUG 717拦截
2021-07-14 09:25:49:641 DEBUG 936拦截
2021-07-14 09:25:49:642 DEBUG 546拦截
2021-07-14 09:25:49:642 DEBUG 796拦截
2021-07-14 09:25:49:642 DEBUG 624拦截
2021-07-14 09:25:49:642 DEBUG 281拦截
2021-07-14 09:25:49:642 DEBUG 467拦截
2021-07-14 09:25:49:642 DEBUG 171拦截
2021-07-14 09:25:49:653 DEBUG 671拦截
2021-07-14 09:25:49:653 DEBUG 342拦截
2021-07-14 09:25:49:743 DEBUG 812拦截
2021-07-14 09:25:49:743 DEBUG 500拦截
2021-07-14 09:25:49:743 DEBUG 359拦截
2021-07-14 09:25:49:743 DEBUG 797拦截
2021-07-14 09:25:49:743 DEBUG 984拦截
2021-07-14 09:25:49:743 DEBUG 734拦截
2021-07-14 09:25:49:743 DEBUG 547拦截
2021-07-14 09:25:49:743 DEBUG 687拦截
2021-07-14 09:25:49:743 DEBUG 593拦截
2021-07-14 09:25:49:743 DEBUG 562拦截
2021-07-14 09:25:49:743 DEBUG 875拦截
2021-07-14 09:25:49:743 DEBUG 282拦截
2021-07-14 09:25:49:745 DEBUG 437拦截
2021-07-14 09:25:49:745 DEBUG 172拦截
2021-07-14 09:25:49:756 DEBUG 312拦截
2021-07-14 09:25:49:756 DEBUG 672拦截
2021-07-14 09:25:49:844 DEBUG 360拦截
2021-07-14 09:25:49:844 DEBUG 985拦截
2021-07-14 09:25:49:844 DEBUG 735拦截
2021-07-14 09:25:49:844 DEBUG 798拦截
2021-07-14 09:25:49:844 DEBUG 548拦截
2021-07-14 09:25:49:844 DEBUG 813拦截
2021-07-14 09:25:49:844 DEBUG 501拦截
2021-07-14 09:25:49:849 DEBUG 688拦截
2021-07-14 09:25:49:849 DEBUG 438拦截
2021-07-14 09:25:49:849 DEBUG 876拦截
2021-07-14 09:25:49:849 DEBUG 563拦截
2021-07-14 09:25:49:849 DEBUG 594拦截
2021-07-14 09:25:49:849 DEBUG 283拦截
2021-07-14 09:25:49:849 DEBUG 173拦截
2021-07-14 09:25:49:857 DEBUG 673拦截
2021-07-14 09:25:49:857 DEBUG 313拦截
2021-07-14 09:25:49:949 DEBUG 814拦截
2021-07-14 09:25:49:949 DEBUG 549拦截
2021-07-14 09:25:49:949 DEBUG 799拦截
2021-07-14 09:25:49:949 DEBUG 502拦截
2021-07-14 09:25:49:949 DEBUG 736拦截
2021-07-14 09:25:49:949 DEBUG 986拦截
2021-07-14 09:25:49:949 DEBUG 361拦截
2021-07-14 09:25:49:953 DEBUG 689拦截
2021-07-14 09:25:49:953 DEBUG 595拦截
2021-07-14 09:25:49:953 DEBUG 564拦截
2021-07-14 09:25:49:953 DEBUG 284拦截
2021-07-14 09:25:49:953 DEBUG 174拦截
2021-07-14 09:25:49:953 DEBUG 877拦截
2021-07-14 09:25:49:953 DEBUG 439拦截
2021-07-14 09:25:49:960 DEBUG 674拦截
2021-07-14 09:25:49:960 DEBUG 314拦截
2021-07-14 09:25:50:053 DEBUG 815拦截
2021-07-14 09:25:50:053 DEBUG 800拦截
2021-07-14 09:25:50:053 DEBUG 362拦截
2021-07-14 09:25:50:053 DEBUG 987拦截
2021-07-14 09:25:50:053 DEBUG 737拦截
2021-07-14 09:25:50:053 DEBUG 550拦截
2021-07-14 09:25:50:053 DEBUG 503拦截
2021-07-14 09:25:50:055 DEBUG 565拦截
2021-07-14 09:25:50:055 DEBUG 440拦截
2021-07-14 09:25:50:055 DEBUG 690拦截
2021-07-14 09:25:50:055 DEBUG 175拦截
2021-07-14 09:25:50:055 DEBUG 878拦截
2021-07-14 09:25:50:055 DEBUG 596拦截
2021-07-14 09:25:50:055 DEBUG 285拦截
2021-07-14 09:25:50:064 DEBUG 675拦截
2021-07-14 09:25:50:064 DEBUG 315拦截
<font color=green>2021-07-14 09:25:50:155 INFO 566放行</font>
<font color=green>2021-07-14 09:25:50:155 INFO 597放行</font>
<font color=green>2021-07-14 09:25:50:155 INFO 176放行</font>
<font color=green>2021-07-14 09:25:50:155 INFO 551放行</font>
<font color=green>2021-07-14 09:25:50:155 INFO 879放行</font>
<font color=green>2021-07-14 09:25:50:155 INFO 504放行</font>
<font color=green>2021-07-14 09:25:50:155 INFO 738放行</font>
<font color=green>2021-07-14 09:25:50:155 INFO 801放行</font>
<font color=green>2021-07-14 09:25:50:155 INFO 988放行</font>
<font color=green>2021-07-14 09:25:50:155 INFO 286放行</font>
<font color=green>2021-07-14 09:25:50:155 INFO 363放行</font>
<font color=green>2021-07-14 09:25:50:155 INFO 691放行</font>
<font color=green>2021-07-14 09:25:50:155 INFO 441放行</font>
<font color=green>2021-07-14 09:25:50:155 INFO 816放行</font>
<font color=green>2021-07-14 09:25:50:170 INFO 316放行</font>
<font color=green>2021-07-14 09:25:50:170 INFO 676放行</font>
2021-07-14 09:25:50:260 DEBUG 177拦截
2021-07-14 09:25:50:260 DEBUG 817拦截
2021-07-14 09:25:50:260 DEBUG 287拦截
2021-07-14 09:25:50:260 DEBUG 364拦截
2021-07-14 09:25:50:260 DEBUG 442拦截
2021-07-14 09:25:50:260 DEBUG 802拦截
2021-07-14 09:25:50:260 DEBUG 989拦截
<font color=green>2021-07-14 09:25:50:260 INFO 552放行</font>
2021-07-14 09:25:50:260 DEBUG 598拦截
<font color=green>2021-07-14 09:25:50:260 INFO 880放行</font>
2021-07-14 09:25:50:260 DEBUG 692拦截
<font color=green>2021-07-14 09:25:50:260 INFO 739放行</font>
2021-07-14 09:25:50:260 DEBUG 505拦截
<font color=green>2021-07-14 09:25:50:260 INFO 567放行</font>
2021-07-14 09:25:50:274 DEBUG 677拦截
2021-07-14 09:25:50:274 DEBUG 317拦截
2021-07-14 09:25:50:365 DEBUG 288拦截
2021-07-14 09:25:50:365 DEBUG 693拦截
2021-07-14 09:25:50:365 DEBUG 178拦截
2021-07-14 09:25:50:365 DEBUG 818拦截
2021-07-14 09:25:50:365 DEBUG 506拦截
2021-07-14 09:25:50:365 DEBUG 365拦截
2021-07-14 09:25:50:365 DEBUG 740拦截
2021-07-14 09:25:50:365 DEBUG 443拦截
2021-07-14 09:25:50:365 DEBUG 990拦截
2021-07-14 09:25:50:365 DEBUG 803拦截
2021-07-14 09:25:50:365 DEBUG 881拦截
2021-07-14 09:25:50:365 DEBUG 568拦截
2021-07-14 09:25:50:365 DEBUG 553拦截
2021-07-14 09:25:50:365 DEBUG 599拦截
2021-07-14 09:25:50:377 DEBUG 318拦截
2021-07-14 09:25:50:377 DEBUG 678拦截
2021-07-14 09:25:50:466 DEBUG 819拦截
2021-07-14 09:25:50:466 DEBUG 179拦截
2021-07-14 09:25:50:466 DEBUG 804拦截
2021-07-14 09:25:50:470 DEBUG 289拦截
2021-07-14 09:25:50:470 DEBUG 569拦截
2021-07-14 09:25:50:470 DEBUG 366拦截
2021-07-14 09:25:50:470 DEBUG 507拦截
2021-07-14 09:25:50:470 DEBUG 694拦截
2021-07-14 09:25:50:470 DEBUG 554拦截
2021-07-14 09:25:50:470 DEBUG 882拦截
2021-07-14 09:25:50:470 DEBUG 991拦截
2021-07-14 09:25:50:470 DEBUG 741拦截
2021-07-14 09:25:50:470 DEBUG 444拦截
2021-07-14 09:25:50:470 DEBUG 600拦截
2021-07-14 09:25:50:480 DEBUG 319拦截
2021-07-14 09:25:50:482 DEBUG 679拦截
2021-07-14 09:25:50:570 DEBUG 180拦截
2021-07-14 09:25:50:570 DEBUG 805拦截
2021-07-14 09:25:50:570 DEBUG 820拦截
2021-07-14 09:25:50:572 DEBUG 290拦截
2021-07-14 09:25:50:572 DEBUG 367拦截
2021-07-14 09:25:50:572 DEBUG 992拦截
2021-07-14 09:25:50:572 DEBUG 601拦截
2021-07-14 09:25:50:572 DEBUG 555拦截
2021-07-14 09:25:50:572 DEBUG 742拦截
2021-07-14 09:25:50:572 DEBUG 445拦截
2021-07-14 09:25:50:572 DEBUG 695拦截
2021-07-14 09:25:50:572 DEBUG 570拦截
2021-07-14 09:25:50:572 DEBUG 883拦截
2021-07-14 09:25:50:572 DEBUG 508拦截
2021-07-14 09:25:50:584 DEBUG 320拦截
2021-07-14 09:25:50:586 DEBUG 680拦截
2021-07-14 09:25:50:674 DEBUG 821拦截
2021-07-14 09:25:50:674 DEBUG 806拦截
2021-07-14 09:25:50:674 DEBUG 181拦截
2021-07-14 09:25:50:677 DEBUG 291拦截
2021-07-14 09:25:50:677 DEBUG 556拦截
2021-07-14 09:25:50:677 DEBUG 743拦截
2021-07-14 09:25:50:677 DEBUG 571拦截
2021-07-14 09:25:50:677 DEBUG 509拦截
2021-07-14 09:25:50:677 DEBUG 884拦截
2021-07-14 09:25:50:677 DEBUG 993拦截
2021-07-14 09:25:50:677 DEBUG 602拦截
2021-07-14 09:25:50:677 DEBUG 696拦截
2021-07-14 09:25:50:677 DEBUG 446拦截
2021-07-14 09:25:50:677 DEBUG 368拦截
2021-07-14 09:25:50:688 DEBUG 321拦截
2021-07-14 09:25:50:688 DEBUG 681拦截
2021-07-14 09:25:50:778 DEBUG 822拦截
2021-07-14 09:25:50:778 DEBUG 807拦截
2021-07-14 09:25:50:778 DEBUG 182拦截
2021-07-14 09:25:50:781 DEBUG 557拦截
2021-07-14 09:25:50:781 DEBUG 510拦截
2021-07-14 09:25:50:781 DEBUG 572拦截
2021-07-14 09:25:50:781 DEBUG 744拦截
2021-07-14 09:25:50:781 DEBUG 697拦截
2021-07-14 09:25:50:781 DEBUG 994拦截
2021-07-14 09:25:50:781 DEBUG 885拦截
2021-07-14 09:25:50:781 DEBUG 292拦截
2021-07-14 09:25:50:781 DEBUG 603拦截
2021-07-14 09:25:50:782 DEBUG 447拦截
2021-07-14 09:25:50:782 DEBUG 369拦截
2021-07-14 09:25:50:791 DEBUG 322拦截
2021-07-14 09:25:50:791 DEBUG 682拦截
2021-07-14 09:25:50:882 DEBUG 808拦截
2021-07-14 09:25:50:882 DEBUG 183拦截
2021-07-14 09:25:50:882 DEBUG 745拦截
2021-07-14 09:25:50:882 DEBUG 511拦截
2021-07-14 09:25:50:882 DEBUG 995拦截
2021-07-14 09:25:50:882 DEBUG 886拦截
2021-07-14 09:25:50:882 DEBUG 558拦截
2021-07-14 09:25:50:882 DEBUG 823拦截
2021-07-14 09:25:50:882 DEBUG 293拦截
2021-07-14 09:25:50:882 DEBUG 698拦截
2021-07-14 09:25:50:882 DEBUG 604拦截
2021-07-14 09:25:50:882 DEBUG 573拦截
2021-07-14 09:25:50:886 DEBUG 448拦截
2021-07-14 09:25:50:886 DEBUG 370拦截
2021-07-14 09:25:50:892 DEBUG 323拦截
2021-07-14 09:25:50:892 DEBUG 683拦截
2021-07-14 09:25:50:986 DEBUG 809拦截
2021-07-14 09:25:50:986 DEBUG 574拦截
2021-07-14 09:25:50:986 DEBUG 887拦截
2021-07-14 09:25:50:986 DEBUG 184拦截
2021-07-14 09:25:50:986 DEBUG 996拦截
2021-07-14 09:25:50:986 DEBUG 699拦截
2021-07-14 09:25:50:986 DEBUG 605拦截
2021-07-14 09:25:50:986 DEBUG 294拦截
2021-07-14 09:25:50:986 DEBUG 746拦截
2021-07-14 09:25:50:986 DEBUG 559拦截
2021-07-14 09:25:50:986 DEBUG 824拦截
2021-07-14 09:25:50:986 DEBUG 512拦截
2021-07-14 09:25:50:989 DEBUG 371拦截
2021-07-14 09:25:50:989 DEBUG 449拦截
2021-07-14 09:25:50:994 DEBUG 324拦截
2021-07-14 09:25:50:994 DEBUG 684拦截
2021-07-14 09:25:51:091 DEBUG 810拦截
2021-07-14 09:25:51:091 DEBUG 888拦截
2021-07-14 09:25:51:091 DEBUG 513拦截
2021-07-14 09:25:51:091 DEBUG 560拦截
2021-07-14 09:25:51:091 DEBUG 747拦截
2021-07-14 09:25:51:091 DEBUG 997拦截
2021-07-14 09:25:51:091 DEBUG 295拦截
2021-07-14 09:25:51:091 DEBUG 606拦截
2021-07-14 09:25:51:091 DEBUG 575拦截
2021-07-14 09:25:51:091 DEBUG 825拦截
2021-07-14 09:25:51:091 DEBUG 185拦截
2021-07-14 09:25:51:091 DEBUG 700拦截
2021-07-14 09:25:51:092 DEBUG 450拦截
2021-07-14 09:25:51:092 DEBUG 372拦截
2021-07-14 09:25:51:099 DEBUG 325拦截
2021-07-14 09:25:51:099 DEBUG 685拦截
<font color=green>2021-07-14 09:25:51:194 INFO 998放行</font>
<font color=green>2021-07-14 09:25:51:194 INFO 889放行</font>
<font color=green>2021-07-14 09:25:51:194 INFO 576放行</font>
<font color=green>2021-07-14 09:25:51:194 INFO 296放行</font>
<font color=green>2021-07-14 09:25:51:194 INFO 748放行</font>
<font color=green>2021-07-14 09:25:51:194 INFO 561放行</font>
<font color=green>2021-07-14 09:25:51:194 INFO 186放行</font>
<font color=green>2021-07-14 09:25:51:194 INFO 373放行</font>
<font color=green>2021-07-14 09:25:51:194 INFO 514放行</font>
<font color=green>2021-07-14 09:25:51:194 INFO 826放行</font>
<font color=green>2021-07-14 09:25:51:194 INFO 811放行</font>
<font color=green>2021-07-14 09:25:51:194 INFO 701放行</font>
<font color=green>2021-07-14 09:25:51:194 INFO 451放行</font>
<font color=green>2021-07-14 09:25:51:194 INFO 607放行</font>
<font color=green>2021-07-14 09:25:51:199 INFO 326放行</font>
<font color=green>2021-07-14 09:25:51:199 INFO 686放行</font>
<font color=green>2021-07-14 09:25:51:299 INFO 749放行</font>
2021-07-14 09:25:51:299 DEBUG 608拦截
2021-07-14 09:25:51:299 DEBUG 484拦截
2021-07-14 09:25:51:299 DEBUG 374拦截
2021-07-14 09:25:51:299 DEBUG 952拦截
<font color=green>2021-07-14 09:25:51:299 INFO 265放行</font>
2021-07-14 09:25:51:299 DEBUG 859拦截
2021-07-14 09:25:51:299 DEBUG 343拦截
2021-07-14 09:25:51:299 DEBUG 140拦截
2021-07-14 09:25:51:299 DEBUG 750拦截
2021-07-14 09:25:51:299 DEBUG 937拦截
<font color=green>2021-07-14 09:25:51:299 INFO 999放行</font>
<font color=green>2021-07-14 09:25:51:299 INFO 297放行</font>
2021-07-14 09:25:51:299 DEBUG 765拦截
2021-07-14 09:25:51:303 DEBUG 843拦截
2021-07-14 09:25:51:303 DEBUG 640拦截
2021-07-14 09:25:51:403 DEBUG 485拦截
2021-07-14 09:25:51:403 DEBUG 468拦截
2021-07-14 09:25:51:403 DEBUG 953拦截
2021-07-14 09:25:51:403 DEBUG 406拦截
2021-07-14 09:25:51:403 DEBUG 77拦截
2021-07-14 09:25:51:403 DEBUG 266拦截
2021-07-14 09:25:51:403 DEBUG 766拦截
2021-07-14 09:25:51:403 DEBUG 298拦截
2021-07-14 09:25:51:403 DEBUG 218拦截
2021-07-14 09:25:51:403 DEBUG 344拦截
2021-07-14 09:25:51:403 DEBUG 938拦截
2021-07-14 09:25:51:403 DEBUG 751拦截
2021-07-14 09:25:51:403 DEBUG 141拦截
2021-07-14 09:25:51:403 DEBUG 860拦截
2021-07-14 09:25:51:406 DEBUG 844拦截
2021-07-14 09:25:51:406 DEBUG 641拦截
2021-07-14 09:25:51:506 DEBUG 486拦截
2021-07-14 09:25:51:506 DEBUG 767拦截
2021-07-14 09:25:51:506 DEBUG 954拦截
2021-07-14 09:25:51:506 DEBUG 267拦截
2021-07-14 09:25:51:506 DEBUG 78拦截
2021-07-14 09:25:51:506 DEBUG 407拦截
2021-07-14 09:25:51:506 DEBUG 469拦截
2021-07-14 09:25:51:506 DEBUG 299拦截
2021-07-14 09:25:51:506 DEBUG 939拦截
2021-07-14 09:25:51:506 DEBUG 345拦截
2021-07-14 09:25:51:506 DEBUG 142拦截
2021-07-14 09:25:51:506 DEBUG 752拦截
2021-07-14 09:25:51:506 DEBUG 219拦截
2021-07-14 09:25:51:506 DEBUG 861拦截
2021-07-14 09:25:51:510 DEBUG 845拦截
2021-07-14 09:25:51:510 DEBUG 642拦截
2021-07-14 09:25:51:606 DEBUG 487拦截
2021-07-14 09:25:51:606 DEBUG 470拦截
2021-07-14 09:25:51:606 DEBUG 955拦截
2021-07-14 09:25:51:606 DEBUG 768拦截
2021-07-14 09:25:51:606 DEBUG 268拦截
2021-07-14 09:25:51:606 DEBUG 300拦截
2021-07-14 09:25:51:606 DEBUG 79拦截
2021-07-14 09:25:51:606 DEBUG 408拦截
2021-07-14 09:25:51:606 DEBUG 346拦截
2021-07-14 09:25:51:606 DEBUG 143拦截
2021-07-14 09:25:51:606 DEBUG 940拦截
2021-07-14 09:25:51:606 DEBUG 753拦截
2021-07-14 09:25:51:606 DEBUG 220拦截
2021-07-14 09:25:51:606 DEBUG 862拦截
2021-07-14 09:25:51:610 DEBUG 846拦截
2021-07-14 09:25:51:610 DEBUG 643拦截
2021-07-14 09:25:51:706 DEBUG 471拦截
2021-07-14 09:25:51:706 DEBUG 409拦截
2021-07-14 09:25:51:706 DEBUG 80拦截
2021-07-14 09:25:51:706 DEBUG 301拦截
2021-07-14 09:25:51:706 DEBUG 488拦截
2021-07-14 09:25:51:706 DEBUG 347拦截
2021-07-14 09:25:51:706 DEBUG 956拦截
2021-07-14 09:25:51:706 DEBUG 941拦截
2021-07-14 09:25:51:706 DEBUG 269拦截
2021-07-14 09:25:51:706 DEBUG 144拦截
2021-07-14 09:25:51:706 DEBUG 769拦截
2021-07-14 09:25:51:706 DEBUG 754拦截
2021-07-14 09:25:51:710 DEBUG 221拦截
2021-07-14 09:25:51:710 DEBUG 863拦截
2021-07-14 09:25:51:714 DEBUG 847拦截
2021-07-14 09:25:51:714 DEBUG 644拦截
2021-07-14 09:25:51:810 DEBUG 489拦截
2021-07-14 09:25:51:810 DEBUG 942拦截
2021-07-14 09:25:51:810 DEBUG 755拦截
2021-07-14 09:25:51:810 DEBUG 472拦截
2021-07-14 09:25:51:810 DEBUG 302拦截
2021-07-14 09:25:51:810 DEBUG 270拦截
2021-07-14 09:25:51:810 DEBUG 957拦截
2021-07-14 09:25:51:810 DEBUG 145拦截
2021-07-14 09:25:51:810 DEBUG 348拦截
2021-07-14 09:25:51:810 DEBUG 770拦截
2021-07-14 09:25:51:810 DEBUG 81拦截
2021-07-14 09:25:51:810 DEBUG 410拦截
2021-07-14 09:25:51:811 DEBUG 222拦截
2021-07-14 09:25:51:811 DEBUG 864拦截
2021-07-14 09:25:51:819 DEBUG 848拦截
2021-07-14 09:25:51:819 DEBUG 645拦截
2021-07-14 09:25:51:910 DEBUG 473拦截
2021-07-14 09:25:51:910 DEBUG 411拦截
2021-07-14 09:25:51:910 DEBUG 82拦截
2021-07-14 09:25:51:910 DEBUG 271拦截
2021-07-14 09:25:51:910 DEBUG 958拦截
2021-07-14 09:25:51:910 DEBUG 756拦截
2021-07-14 09:25:51:910 DEBUG 943拦截
2021-07-14 09:25:51:910 DEBUG 771拦截
2021-07-14 09:25:51:910 DEBUG 303拦截
2021-07-14 09:25:51:910 DEBUG 349拦截
2021-07-14 09:25:51:910 DEBUG 490拦截
2021-07-14 09:25:51:910 DEBUG 146拦截
2021-07-14 09:25:51:914 DEBUG 865拦截
2021-07-14 09:25:51:914 DEBUG 223拦截
2021-07-14 09:25:51:923 DEBUG 646拦截
2021-07-14 09:25:51:923 DEBUG 849拦截
2021-07-14 09:25:52:013 DEBUG 474拦截
2021-07-14 09:25:52:013 DEBUG 772拦截
2021-07-14 09:25:52:013 DEBUG 304拦截
2021-07-14 09:25:52:013 DEBUG 83拦截
2021-07-14 09:25:52:013 DEBUG 147拦截
2021-07-14 09:25:52:013 DEBUG 491拦截
2021-07-14 09:25:52:013 DEBUG 272拦截
2021-07-14 09:25:52:013 DEBUG 959拦截
2021-07-14 09:25:52:013 DEBUG 944拦截
2021-07-14 09:25:52:013 DEBUG 412拦截
2021-07-14 09:25:52:013 DEBUG 757拦截
2021-07-14 09:25:52:013 DEBUG 350拦截
2021-07-14 09:25:52:019 DEBUG 866拦截
2021-07-14 09:25:52:019 DEBUG 224拦截
2021-07-14 09:25:52:025 DEBUG 850拦截
2021-07-14 09:25:52:025 DEBUG 647拦截
2021-07-14 09:25:52:118 DEBUG 305拦截
2021-07-14 09:25:52:118 DEBUG 492拦截
2021-07-14 09:25:52:118 DEBUG 84拦截
2021-07-14 09:25:52:118 DEBUG 475拦截
2021-07-14 09:25:52:118 DEBUG 273拦截
2021-07-14 09:25:52:118 DEBUG 773拦截
2021-07-14 09:25:52:118 DEBUG 148拦截
2021-07-14 09:25:52:118 DEBUG 758拦截
2021-07-14 09:25:52:118 DEBUG 945拦截
2021-07-14 09:25:52:118 DEBUG 413拦截
2021-07-14 09:25:52:118 DEBUG 351拦截
2021-07-14 09:25:52:118 DEBUG 960拦截
2021-07-14 09:25:52:121 DEBUG 225拦截
2021-07-14 09:25:52:121 DEBUG 867拦截
2021-07-14 09:25:52:130 DEBUG 851拦截
2021-07-14 09:25:52:130 DEBUG 648拦截
<font color=green>2021-07-14 09:25:52:220 INFO 946放行</font>
<font color=green>2021-07-14 09:25:52:220 INFO 493放行</font>
<font color=green>2021-07-14 09:25:52:220 INFO 961放行</font>
<font color=green>2021-07-14 09:25:52:220 INFO 759放行</font>
<font color=green>2021-07-14 09:25:52:220 INFO 306放行</font>
<font color=green>2021-07-14 09:25:52:220 INFO 352放行</font>
<font color=green>2021-07-14 09:25:52:220 INFO 476放行</font>
<font color=green>2021-07-14 09:25:52:220 INFO 774放行</font>
<font color=green>2021-07-14 09:25:52:220 INFO 149放行</font>
<font color=green>2021-07-14 09:25:52:220 INFO 274放行</font>
<font color=green>2021-07-14 09:25:52:220 INFO 85放行</font>
<font color=green>2021-07-14 09:25:52:220 INFO 414放行</font>
<font color=green>2021-07-14 09:25:52:225 INFO 868放行</font>
<font color=green>2021-07-14 09:25:52:225 INFO 226放行</font>
<font color=green>2021-07-14 09:25:52:232 INFO 649放行</font>
<font color=green>2021-07-14 09:25:52:232 INFO 852放行</font>
<font color=green>2021-07-14 09:25:52:322 INFO 947放行</font>
<font color=green>2021-07-14 09:25:52:322 INFO 962放行</font>
2021-07-14 09:25:52:322 DEBUG 307拦截
2021-07-14 09:25:52:322 DEBUG 275拦截
<font color=green>2021-07-14 09:25:52:322 INFO 494放行</font>
2021-07-14 09:25:52:322 DEBUG 775拦截
2021-07-14 09:25:52:322 DEBUG 86拦截
2021-07-14 09:25:52:322 DEBUG 415拦截
2021-07-14 09:25:52:322 DEBUG 477拦截
<font color=green>2021-07-14 09:25:52:322 INFO 760放行</font>
2021-07-14 09:25:52:322 DEBUG 353拦截
2021-07-14 09:25:52:322 DEBUG 150拦截
2021-07-14 09:25:52:328 DEBUG 869拦截
2021-07-14 09:25:52:328 DEBUG 227拦截
2021-07-14 09:25:52:337 DEBUG 650拦截
2021-07-14 09:25:52:337 DEBUG 853拦截
2021-07-14 09:25:52:426 DEBUG 495拦截
2021-07-14 09:25:52:427 DEBUG 948拦截
2021-07-14 09:25:52:427 DEBUG 151拦截
2021-07-14 09:25:52:427 DEBUG 354拦截
2021-07-14 09:25:52:427 DEBUG 478拦截
2021-07-14 09:25:52:427 DEBUG 776拦截
2021-07-14 09:25:52:427 DEBUG 963拦截
2021-07-14 09:25:52:427 DEBUG 308拦截
2021-07-14 09:25:52:427 DEBUG 87拦截
2021-07-14 09:25:52:427 DEBUG 416拦截
2021-07-14 09:25:52:427 DEBUG 761拦截
2021-07-14 09:25:52:427 DEBUG 276拦截
2021-07-14 09:25:52:432 DEBUG 228拦截
2021-07-14 09:25:52:432 DEBUG 870拦截
2021-07-14 09:25:52:439 DEBUG 651拦截
2021-07-14 09:25:52:439 DEBUG 854拦截
2021-07-14 09:25:52:530 DEBUG 479拦截
2021-07-14 09:25:52:530 DEBUG 762拦截
2021-07-14 09:25:52:530 DEBUG 277拦截
2021-07-14 09:25:52:530 DEBUG 417拦截
2021-07-14 09:25:52:530 DEBUG 88拦截
2021-07-14 09:25:52:530 DEBUG 309拦截
2021-07-14 09:25:52:530 DEBUG 355拦截
2021-07-14 09:25:52:530 DEBUG 964拦截
2021-07-14 09:25:52:530 DEBUG 949拦截
2021-07-14 09:25:52:530 DEBUG 777拦截
2021-07-14 09:25:52:530 DEBUG 152拦截
2021-07-14 09:25:52:530 DEBUG 496拦截
2021-07-14 09:25:52:533 DEBUG 229拦截
2021-07-14 09:25:52:533 DEBUG 871拦截
2021-07-14 09:25:52:541 DEBUG 855拦截
2021-07-14 09:25:52:541 DEBUG 652拦截
2021-07-14 09:25:52:635 DEBUG 418拦截
2021-07-14 09:25:52:635 DEBUG 778拦截
2021-07-14 09:25:52:635 DEBUG 153拦截
2021-07-14 09:25:52:635 DEBUG 950拦截
2021-07-14 09:25:52:635 DEBUG 278拦截
2021-07-14 09:25:52:635 DEBUG 310拦截
2021-07-14 09:25:52:635 DEBUG 480拦截
2021-07-14 09:25:52:635 DEBUG 356拦截
2021-07-14 09:25:52:635 DEBUG 763拦截
2021-07-14 09:25:52:635 DEBUG 965拦截
2021-07-14 09:25:52:635 DEBUG 89拦截
2021-07-14 09:25:52:636 DEBUG 497拦截
2021-07-14 09:25:52:637 DEBUG 872拦截
2021-07-14 09:25:52:637 DEBUG 230拦截
2021-07-14 09:25:52:643 DEBUG 856拦截
2021-07-14 09:25:52:645 DEBUG 653拦截
2021-07-14 09:25:52:738 DEBUG 419拦截
2021-07-14 09:25:52:738 DEBUG 154拦截
2021-07-14 09:25:52:738 DEBUG 311拦截
2021-07-14 09:25:52:738 DEBUG 90拦截
2021-07-14 09:25:52:738 DEBUG 951拦截
2021-07-14 09:25:52:738 DEBUG 779拦截
2021-07-14 09:25:52:738 DEBUG 279拦截
2021-07-14 09:25:52:738 DEBUG 498拦截
2021-07-14 09:25:52:738 DEBUG 481拦截
2021-07-14 09:25:52:738 DEBUG 966拦截
2021-07-14 09:25:52:738 DEBUG 764拦截
2021-07-14 09:25:52:738 DEBUG 357拦截
2021-07-14 09:25:52:741 DEBUG 231拦截
2021-07-14 09:25:52:741 DEBUG 873拦截
2021-07-14 09:25:52:749 DEBUG 857拦截
2021-07-14 09:25:52:750 DEBUG 654拦截
2021-07-14 09:25:52:839 DEBUG 780拦截
2021-07-14 09:25:52:839 DEBUG 155拦截
2021-07-14 09:25:52:839 DEBUG 202拦截
2021-07-14 09:25:52:839 DEBUG 420拦截
2021-07-14 09:25:52:839 DEBUG 91拦截
2021-07-14 09:25:52:843 DEBUG 31拦截
2021-07-14 09:25:52:843 DEBUG 499拦截
2021-07-14 09:25:52:843 DEBUG 280拦截
2021-07-14 09:25:52:843 DEBUG 232拦截
2021-07-14 09:25:52:843 DEBUG 625拦截
2021-07-14 09:25:52:843 DEBUG 358拦截
2021-07-14 09:25:52:843 DEBUG 482拦截
2021-07-14 09:25:52:843 DEBUG 874拦截
2021-07-14 09:25:52:843 DEBUG 967拦截
2021-07-14 09:25:52:853 DEBUG 858拦截
2021-07-14 09:25:52:853 DEBUG 655拦截
2021-07-14 09:25:52:943 DEBUG 390拦截
2021-07-14 09:25:52:943 DEBUG 421拦截
2021-07-14 09:25:52:943 DEBUG 125拦截
2021-07-14 09:25:52:943 DEBUG 203拦截
2021-07-14 09:25:52:943 DEBUG 92拦截
2021-07-14 09:25:52:943 DEBUG 32拦截
2021-07-14 09:25:52:943 DEBUG 233拦截
2021-07-14 09:25:52:943 DEBUG 250拦截
2021-07-14 09:25:52:944 DEBUG 626拦截
2021-07-14 09:25:52:944 DEBUG 375拦截
2021-07-14 09:25:52:949 DEBUG 187拦截
2021-07-14 09:25:52:949 DEBUG 109拦截
2021-07-14 09:25:52:949 DEBUG 93拦截
2021-07-14 09:25:52:949 DEBUG 483拦截
2021-07-14 09:25:52:953 DEBUG 62拦截
2021-07-14 09:25:52:954 DEBUG 15拦截
2021-07-14 09:25:53:044 DEBUG 422拦截
2021-07-14 09:25:53:044 DEBUG 126拦截
2021-07-14 09:25:53:044 DEBUG 204拦截
2021-07-14 09:25:53:044 DEBUG 33拦截
2021-07-14 09:25:53:044 DEBUG 46拦截
2021-07-14 09:25:53:044 DEBUG 251拦截
2021-07-14 09:25:53:044 DEBUG 391拦截
2021-07-14 09:25:53:044 DEBUG 234拦截
2021-07-14 09:25:53:049 DEBUG 627拦截
2021-07-14 09:25:53:049 DEBUG 376拦截
2021-07-14 09:25:53:053 DEBUG 188拦截
2021-07-14 09:25:53:053 DEBUG 0拦截
2021-07-14 09:25:53:053 DEBUG 94拦截
2021-07-14 09:25:53:053 DEBUG 110拦截
2021-07-14 09:25:53:056 DEBUG 63拦截
2021-07-14 09:25:53:057 DEBUG 16拦截
2021-07-14 09:25:53:149 DEBUG 127拦截
2021-07-14 09:25:53:149 DEBUG 47拦截
2021-07-14 09:25:53:149 DEBUG 34拦截
2021-07-14 09:25:53:149 DEBUG 235拦截
2021-07-14 09:25:53:149 DEBUG 392拦截
2021-07-14 09:25:53:149 DEBUG 205拦截
2021-07-14 09:25:53:149 DEBUG 252拦截
2021-07-14 09:25:53:149 DEBUG 423拦截
2021-07-14 09:25:53:153 DEBUG 628拦截
2021-07-14 09:25:53:153 DEBUG 377拦截
2021-07-14 09:25:53:155 DEBUG 111拦截
2021-07-14 09:25:53:155 DEBUG 95拦截
2021-07-14 09:25:53:155 DEBUG 189拦截
2021-07-14 09:25:53:155 DEBUG 1拦截
2021-07-14 09:25:53:160 DEBUG 64拦截
2021-07-14 09:25:53:162 DEBUG 17拦截
<font color=green>2021-07-14 09:25:53:254 INFO 48放行</font>
<font color=green>2021-07-14 09:25:53:254 INFO 424放行</font>
<font color=green>2021-07-14 09:25:53:254 INFO 393放行</font>
<font color=green>2021-07-14 09:25:53:254 INFO 35放行</font>
<font color=green>2021-07-14 09:25:53:254 INFO 206放行</font>
<font color=green>2021-07-14 09:25:53:254 INFO 128放行</font>
<font color=green>2021-07-14 09:25:53:254 INFO 253放行</font>
<font color=green>2021-07-14 09:25:53:254 INFO 236放行</font>
<font color=green>2021-07-14 09:25:53:256 INFO 378放行</font>
<font color=green>2021-07-14 09:25:53:256 INFO 629放行</font>
<font color=green>2021-07-14 09:25:53:260 INFO 96放行</font>
<font color=green>2021-07-14 09:25:53:260 INFO 2放行</font>
<font color=green>2021-07-14 09:25:53:260 INFO 190放行</font>
<font color=green>2021-07-14 09:25:53:260 INFO 112放行</font>
<font color=green>2021-07-14 09:25:53:265 INFO 65放行</font>
<font color=green>2021-07-14 09:25:53:265 INFO 18放行</font>
<font color=green>2021-07-14 09:25:53:354 INFO 49放行</font>
<font color=green>2021-07-14 09:25:53:354 INFO 425放行</font>
<font color=green>2021-07-14 09:25:53:354 INFO 394放行</font>
<font color=green>2021-07-14 09:25:53:354 INFO 36放行</font>
2021-07-14 09:25:53:354 DEBUG 207拦截
2021-07-14 09:25:53:354 DEBUG 129拦截
2021-07-14 09:25:53:354 DEBUG 254拦截
2021-07-14 09:25:53:354 DEBUG 237拦截
2021-07-14 09:25:53:360 DEBUG 379拦截
2021-07-14 09:25:53:360 DEBUG 630拦截
2021-07-14 09:25:53:364 DEBUG 97拦截
2021-07-14 09:25:53:364 DEBUG 191拦截
2021-07-14 09:25:53:364 DEBUG 113拦截
2021-07-14 09:25:53:364 DEBUG 3拦截
2021-07-14 09:25:53:370 DEBUG 19拦截
2021-07-14 09:25:53:370 DEBUG 66拦截
2021-07-14 09:25:53:457 DEBUG 50拦截
2021-07-14 09:25:53:457 DEBUG 255拦截
2021-07-14 09:25:53:457 DEBUG 395拦截
2021-07-14 09:25:53:457 DEBUG 238拦截
2021-07-14 09:25:53:457 DEBUG 208拦截
2021-07-14 09:25:53:457 DEBUG 426拦截
2021-07-14 09:25:53:457 DEBUG 130拦截
2021-07-14 09:25:53:457 DEBUG 37拦截
2021-07-14 09:25:53:462 DEBUG 380拦截
2021-07-14 09:25:53:462 DEBUG 631拦截
2021-07-14 09:25:53:467 DEBUG 192拦截
2021-07-14 09:25:53:467 DEBUG 114拦截
2021-07-14 09:25:53:467 DEBUG 98拦截
2021-07-14 09:25:53:467 DEBUG 4拦截
2021-07-14 09:25:53:473 DEBUG 20拦截
2021-07-14 09:25:53:473 DEBUG 67拦截
2021-07-14 09:25:53:557 DEBUG 51拦截
2021-07-14 09:25:53:557 DEBUG 427拦截
2021-07-14 09:25:53:557 DEBUG 38拦截
2021-07-14 09:25:53:557 DEBUG 396拦截
2021-07-14 09:25:53:557 DEBUG 131拦截
2021-07-14 09:25:53:557 DEBUG 239拦截
2021-07-14 09:25:53:557 DEBUG 209拦截
2021-07-14 09:25:53:557 DEBUG 256拦截
2021-07-14 09:25:53:563 DEBUG 632拦截
2021-07-14 09:25:53:563 DEBUG 381拦截
2021-07-14 09:25:53:570 DEBUG 115拦截
2021-07-14 09:25:53:570 DEBUG 5拦截
2021-07-14 09:25:53:570 DEBUG 99拦截
2021-07-14 09:25:53:570 DEBUG 193拦截
2021-07-14 09:25:53:577 DEBUG 21拦截
2021-07-14 09:25:53:577 DEBUG 68拦截
2021-07-14 09:25:53:659 DEBUG 397拦截
2021-07-14 09:25:53:659 DEBUG 39拦截
2021-07-14 09:25:53:659 DEBUG 257拦截
2021-07-14 09:25:53:659 DEBUG 52拦截
2021-07-14 09:25:53:659 DEBUG 210拦截
2021-07-14 09:25:53:659 DEBUG 132拦截
2021-07-14 09:25:53:659 DEBUG 240拦截
2021-07-14 09:25:53:659 DEBUG 428拦截
2021-07-14 09:25:53:666 DEBUG 633拦截
2021-07-14 09:25:53:666 DEBUG 382拦截
2021-07-14 09:25:53:673 DEBUG 6拦截
2021-07-14 09:25:53:673 DEBUG 116拦截
2021-07-14 09:25:53:673 DEBUG 194拦截
2021-07-14 09:25:53:673 DEBUG 100拦截
2021-07-14 09:25:53:680 DEBUG 22拦截
2021-07-14 09:25:53:681 DEBUG 69拦截
2021-07-14 09:25:53:763 DEBUG 40拦截
2021-07-14 09:25:53:763 DEBUG 258拦截
2021-07-14 09:25:53:763 DEBUG 398拦截
2021-07-14 09:25:53:763 DEBUG 241拦截
2021-07-14 09:25:53:763 DEBUG 429拦截
2021-07-14 09:25:53:763 DEBUG 53拦截
2021-07-14 09:25:53:763 DEBUG 133拦截
2021-07-14 09:25:53:763 DEBUG 211拦截
2021-07-14 09:25:53:770 DEBUG 634拦截
2021-07-14 09:25:53:770 DEBUG 383拦截
2021-07-14 09:25:53:777 DEBUG 7拦截
2021-07-14 09:25:53:777 DEBUG 195拦截
2021-07-14 09:25:53:777 DEBUG 101拦截
2021-07-14 09:25:53:778 DEBUG 117拦截
2021-07-14 09:25:53:783 DEBUG 23拦截
2021-07-14 09:25:53:783 DEBUG 70拦截
2021-07-14 09:25:53:865 DEBUG 54拦截
2021-07-14 09:25:53:865 DEBUG 430拦截
2021-07-14 09:25:53:865 DEBUG 399拦截
2021-07-14 09:25:53:865 DEBUG 259拦截
2021-07-14 09:25:53:865 DEBUG 242拦截
2021-07-14 09:25:53:865 DEBUG 134拦截
2021-07-14 09:25:53:865 DEBUG 41拦截
2021-07-14 09:25:53:865 DEBUG 212拦截
2021-07-14 09:25:53:871 DEBUG 635拦截
2021-07-14 09:25:53:871 DEBUG 384拦截
2021-07-14 09:25:53:877 DEBUG 196拦截
2021-07-14 09:25:53:877 DEBUG 102拦截
2021-07-14 09:25:53:877 DEBUG 8拦截
2021-07-14 09:25:53:882 DEBUG 118拦截
2021-07-14 09:25:53:886 DEBUG 71拦截
2021-07-14 09:25:53:886 DEBUG 24拦截
2021-07-14 09:25:53:970 DEBUG 400拦截
2021-07-14 09:25:53:970 DEBUG 213拦截
2021-07-14 09:25:53:970 DEBUG 55拦截
2021-07-14 09:25:53:970 DEBUG 135拦截
2021-07-14 09:25:53:970 DEBUG 260拦截
2021-07-14 09:25:53:970 DEBUG 431拦截
2021-07-14 09:25:53:970 DEBUG 243拦截
2021-07-14 09:25:53:970 DEBUG 42拦截
2021-07-14 09:25:53:974 DEBUG 636拦截
2021-07-14 09:25:53:974 DEBUG 385拦截
2021-07-14 09:25:53:982 DEBUG 197拦截
2021-07-14 09:25:53:982 DEBUG 103拦截
2021-07-14 09:25:53:982 DEBUG 9拦截
2021-07-14 09:25:53:986 DEBUG 119拦截
2021-07-14 09:25:53:991 DEBUG 72拦截
2021-07-14 09:25:53:991 DEBUG 25拦截
2021-07-14 09:25:54:072 DEBUG 261拦截
2021-07-14 09:25:54:072 DEBUG 214拦截
2021-07-14 09:25:54:072 DEBUG 244拦截
2021-07-14 09:25:54:072 DEBUG 432拦截
2021-07-14 09:25:54:072 DEBUG 136拦截
2021-07-14 09:25:54:072 DEBUG 43拦截
2021-07-14 09:25:54:072 DEBUG 401拦截
2021-07-14 09:25:54:072 DEBUG 56拦截
2021-07-14 09:25:54:077 DEBUG 637拦截
2021-07-14 09:25:54:077 DEBUG 386拦截
2021-07-14 09:25:54:083 DEBUG 10拦截
2021-07-14 09:25:54:083 DEBUG 104拦截
2021-07-14 09:25:54:083 DEBUG 198拦截
2021-07-14 09:25:54:088 DEBUG 120拦截
2021-07-14 09:25:54:093 DEBUG 73拦截
2021-07-14 09:25:54:093 DEBUG 26拦截
2021-07-14 09:25:54:174 DEBUG 262拦截
2021-07-14 09:25:54:174 DEBUG 402拦截
2021-07-14 09:25:54:174 DEBUG 44拦截
2021-07-14 09:25:54:174 DEBUG 245拦截
2021-07-14 09:25:54:174 DEBUG 137拦截
2021-07-14 09:25:54:174 DEBUG 57拦截
2021-07-14 09:25:54:174 DEBUG 433拦截
2021-07-14 09:25:54:174 DEBUG 215拦截
2021-07-14 09:25:54:181 DEBUG 638拦截
2021-07-14 09:25:54:181 DEBUG 387拦截
2021-07-14 09:25:54:185 DEBUG 11拦截
2021-07-14 09:25:54:185 DEBUG 105拦截
2021-07-14 09:25:54:185 DEBUG 199拦截
2021-07-14 09:25:54:191 DEBUG 121拦截
2021-07-14 09:25:54:198 DEBUG 74拦截
2021-07-14 09:25:54:198 DEBUG 27拦截
<font color=green>2021-07-14 09:25:54:277 INFO 138放行</font>
<font color=green>2021-07-14 09:25:54:277 INFO 58放行</font>
<font color=green>2021-07-14 09:25:54:277 INFO 403放行</font>
<font color=green>2021-07-14 09:25:54:277 INFO 45放行</font>
<font color=green>2021-07-14 09:25:54:277 INFO 216放行</font>
<font color=green>2021-07-14 09:25:54:277 INFO 263放行</font>
<font color=green>2021-07-14 09:25:54:277 INFO 246放行</font>
<font color=green>2021-07-14 09:25:54:277 INFO 434放行</font>
<font color=green>2021-07-14 09:25:54:282 INFO 388放行</font>
<font color=green>2021-07-14 09:25:54:282 INFO 639放行</font>
<font color=green>2021-07-14 09:25:54:288 INFO 106放行</font>
<font color=green>2021-07-14 09:25:54:288 INFO 12放行</font>
<font color=green>2021-07-14 09:25:54:288 INFO 200放行</font>
<font color=green>2021-07-14 09:25:54:291 INFO 122放行</font>
<font color=green>2021-07-14 09:25:54:299 INFO 75放行</font>
<font color=green>2021-07-14 09:25:54:299 INFO 28放行</font>
<font color=green>2021-07-14 09:25:54:377 INFO 139放行</font>
<font color=green>2021-07-14 09:25:54:377 INFO 217放行</font>
2021-07-14 09:25:54:377 DEBUG 247拦截
2021-07-14 09:25:54:377 DEBUG 59拦截
2021-07-14 09:25:54:377 DEBUG 435拦截
<font color=green>2021-07-14 09:25:54:377 INFO 264放行</font>
<font color=green>2021-07-14 09:25:54:377 INFO 404放行</font>
2021-07-14 09:25:54:382 DEBUG 389拦截
2021-07-14 09:25:54:391 DEBUG 13拦截
2021-07-14 09:25:54:391 DEBUG 107拦截
2021-07-14 09:25:54:391 DEBUG 201拦截
2021-07-14 09:25:54:392 DEBUG 123拦截
2021-07-14 09:25:54:403 DEBUG 29拦截
2021-07-14 09:25:54:403 DEBUG 76拦截
2021-07-14 09:25:54:479 DEBUG 405拦截
2021-07-14 09:25:54:479 DEBUG 248拦截
2021-07-14 09:25:54:479 DEBUG 60拦截
2021-07-14 09:25:54:482 DEBUG 436拦截
2021-07-14 09:25:54:495 DEBUG 14拦截
2021-07-14 09:25:54:495 DEBUG 108拦截
2021-07-14 09:25:54:495 DEBUG 124拦截
2021-07-14 09:25:54:505 DEBUG 30拦截
2021-07-14 09:25:54:582 DEBUG 249拦截
2021-07-14 09:25:54:582 DEBUG 61拦截


***

从结果上可以看出，虽然做到了在任意窗口期都限制在了最大限流值以下，但是**请求还是过于集中**「1秒内的请求，都是集中在前10ms之内通过」。或许可以使用更细力度的限流，比如0.1秒限流10。

也就是固定窗口或者滑动窗口，对于突发流量的限流都**不够平滑**。

## 令牌桶

<img src="https://gitee.com/wangigor/typora-images/raw/master/image-20210715094506973.png" alt="image-20210715094506973" style="zoom:50%;" />

> 假设流量限制为：**t**秒限制**limit**次请求。
>
> - 创建一个「总量为limit，当前可用容量为0」的**令牌桶**。
> - 一个组件「线程」，以间隔「**t/limit**」秒时间向令牌桶中添加1个令牌「capacity+1」。
> - 桶中最多有limit个令牌，如果添加时超量就丢弃。
> - 请求进来时，先去令牌桶获取令牌。
>   - 获取到令牌就**执行**。
>   - 获取不到令牌就**阻塞等待或者拦截**「具体依拒绝策略而定」。
>
> 有几点好处：
>
> - 应对项目启动时的大流量，对后续方法执行有**预热**作用。
> - 因为令牌是以t/limit的时间间隔添加进桶，每一个固定时间间隔t内都不会超过**流量限制**limit「跟滑动窗口一样」。
> - 整形效果更好，**更平滑**。
> - 可以应对突发的大流量。
>
> 但是这个平滑是对于通过的流量来说的，当时从整体上来看似乎会有弊端。
>
> 如果是直接拦截策略，当令牌桶没有时，t/limit内的所有流量都会被限制为1。因为请求是随机到来，所以或许有些本该在这个t时间内放行的请求被**误杀**。
>
> 由此看来，令牌桶这种限流方式**比较适合阻塞式限流**。比如后台job类的限流，超过限制之后进行阻塞等待，有令牌了再执行。

```java
@Slf4j
public class TokenLimiter {
    private final int limit;
    private int capacity;
    private long period;
    private TimeUnit timeUnit;

    static long capacityOffset;
    static Unsafe unsafe;


    static {
        try {
            Field theUnsafeField = Unsafe.class.getDeclaredField("theUnsafe");
            theUnsafeField.setAccessible(true);
            unsafe = (Unsafe) theUnsafeField.get(null);

            capacityOffset = unsafe.objectFieldOffset(TokenLimiter.class.getDeclaredField("capacity"));
        } catch (Exception e) {
            e.printStackTrace();
        }
    }

    public TokenLimiter(int limit, long period, TimeUnit timeUnit) {
        this.limit = limit;
        this.period = period;
        this.timeUnit = timeUnit;
        this.capacity = 0;

        Timer timer = new Timer("TokenLimiter");
        timer.schedule(new TimerTask() {
            @Override
            public void run() {
                //添加令牌
                addToken();
            }
        }, 0L, timeUnit.toMillis(period) / limit);
    }

    /**
     * 添加1个token
     */
    private void addToken() {
        //自旋
        for (; ; ) {
            int current = unsafe.getInt(this, capacityOffset);
            //超过总容量就不添加了。
            if (current > limit) return;
            //cas
            if (unsafe.compareAndSwapInt(this, capacityOffset, current, current + 1)) return;
        }
    }

    /**
     * 尝试获取令牌
     * 非阻塞
     */
    private boolean tryAcquire() {
        for (; ; ) {
            int current = unsafe.getInt(this, capacityOffset);
            //容量不够
            if (current <= 0) return false;
            //cas
            if (unsafe.compareAndSwapInt(this, capacityOffset, current, current - 1)) return true;
        }
    }

    /**
     * 获取令牌
     * 阻塞
     */
    private void acquire() {
        //这里线程就不挂起了。
        while (!tryAcquire()) ;
    }

    public static void main(String[] args) throws InterruptedException {
      	//1s限制10个请求
        TokenLimiter limiter = new TokenLimiter(10, 1, TimeUnit.SECONDS);


        IntStream.range(0, 100).parallel().forEach(i -> {
            limiter.acquire();
            log.info(i + "执行");

        });
    }
}
```

```log
100个请求，都被整流成了100ms执行一次。

2021-07-15 11:21:43:162 INFO 65执行
2021-07-15 11:21:43:234 INFO 67执行
2021-07-15 11:21:43:339 INFO 82执行
2021-07-15 11:21:43:444 INFO 7执行
2021-07-15 11:21:43:544 INFO 32执行
2021-07-15 11:21:43:645 INFO 72执行
2021-07-15 11:21:43:746 INFO 66执行
2021-07-15 11:21:43:850 INFO 97执行
2021-07-15 11:21:43:954 INFO 57执行
2021-07-15 11:21:44:054 INFO 83执行
2021-07-15 11:21:44:155 INFO 90执行
2021-07-15 11:21:44:256 INFO 69执行
2021-07-15 11:21:44:357 INFO 68执行
2021-07-15 11:21:44:462 INFO 63执行
2021-07-15 11:21:44:563 INFO 92执行
2021-07-15 11:21:44:666 INFO 94执行
2021-07-15 11:21:44:770 INFO 8执行
2021-07-15 11:21:44:870 INFO 91执行
2021-07-15 11:21:44:976 INFO 53执行
2021-07-15 11:21:45:075 INFO 95执行
2021-07-15 11:21:45:176 INFO 33执行
2021-07-15 11:21:45:276 INFO 99执行
2021-07-15 11:21:45:380 INFO 58执行
2021-07-15 11:21:45:481 INFO 74执行
2021-07-15 11:21:45:581 INFO 70执行
2021-07-15 11:21:45:681 INFO 88执行
2021-07-15 11:21:45:783 INFO 96执行
2021-07-15 11:21:45:888 INFO 51执行
2021-07-15 11:21:45:989 INFO 89执行
2021-07-15 11:21:46:094 INFO 98执行
2021-07-15 11:21:46:197 INFO 31执行
2021-07-15 11:21:46:299 INFO 54执行
2021-07-15 11:21:46:399 INFO 28执行
2021-07-15 11:21:46:500 INFO 71执行
2021-07-15 11:21:46:600 INFO 15执行
2021-07-15 11:21:46:702 INFO 56执行
2021-07-15 11:21:46:803 INFO 52执行
2021-07-15 11:21:46:907 INFO 38执行
2021-07-15 11:21:47:009 INFO 60执行
2021-07-15 11:21:47:111 INFO 17执行
2021-07-15 11:21:47:214 INFO 61执行
2021-07-15 11:21:47:314 INFO 55执行
2021-07-15 11:21:47:417 INFO 87执行
2021-07-15 11:21:47:518 INFO 6执行
2021-07-15 11:21:47:621 INFO 30执行
2021-07-15 11:21:47:725 INFO 59执行
2021-07-15 11:21:47:829 INFO 10执行
2021-07-15 11:21:47:934 INFO 44执行
2021-07-15 11:21:48:037 INFO 64执行
2021-07-15 11:21:48:139 INFO 48执行
2021-07-15 11:21:48:241 INFO 16执行
2021-07-15 11:21:48:342 INFO 62执行
2021-07-15 11:21:48:447 INFO 39执行
2021-07-15 11:21:48:548 INFO 50执行
2021-07-15 11:21:48:648 INFO 49执行
2021-07-15 11:21:48:749 INFO 93执行
2021-07-15 11:21:48:850 INFO 40执行
2021-07-15 11:21:48:955 INFO 46执行
2021-07-15 11:21:49:056 INFO 81执行
2021-07-15 11:21:49:158 INFO 19执行
2021-07-15 11:21:49:263 INFO 29执行
2021-07-15 11:21:49:366 INFO 78执行
2021-07-15 11:21:49:467 INFO 85执行
2021-07-15 11:21:49:567 INFO 11执行
2021-07-15 11:21:49:668 INFO 73执行
2021-07-15 11:21:49:770 INFO 43执行
2021-07-15 11:21:49:872 INFO 13执行
2021-07-15 11:21:49:973 INFO 79执行
2021-07-15 11:21:50:074 INFO 26执行
2021-07-15 11:21:50:179 INFO 34执行
2021-07-15 11:21:50:282 INFO 37执行
2021-07-15 11:21:50:383 INFO 35执行
2021-07-15 11:21:50:488 INFO 41执行
2021-07-15 11:21:50:591 INFO 47执行
2021-07-15 11:21:50:691 INFO 24执行
2021-07-15 11:21:50:792 INFO 27执行
2021-07-15 11:21:50:895 INFO 14执行
2021-07-15 11:21:50:997 INFO 20执行
2021-07-15 11:21:51:099 INFO 76执行
2021-07-15 11:21:51:199 INFO 3执行
2021-07-15 11:21:51:300 INFO 25执行
2021-07-15 11:21:51:403 INFO 86执行
2021-07-15 11:21:51:503 INFO 12执行
2021-07-15 11:21:51:607 INFO 36执行
2021-07-15 11:21:51:707 INFO 0执行
2021-07-15 11:21:51:811 INFO 5执行
2021-07-15 11:21:51:912 INFO 21执行
2021-07-15 11:21:52:017 INFO 42执行
2021-07-15 11:21:52:117 INFO 22执行
2021-07-15 11:21:52:220 INFO 45执行
2021-07-15 11:21:52:324 INFO 4执行
2021-07-15 11:21:52:429 INFO 75执行
2021-07-15 11:21:52:534 INFO 9执行
2021-07-15 11:21:52:639 INFO 84执行
2021-07-15 11:21:52:741 INFO 18执行
2021-07-15 11:21:52:846 INFO 80执行
2021-07-15 11:21:52:950 INFO 23执行
2021-07-15 11:21:53:055 INFO 1执行
2021-07-15 11:21:53:156 INFO 2执行
2021-07-15 11:21:53:256 INFO 77执行
```

